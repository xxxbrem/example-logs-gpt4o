SELECT 
    z."zip_code",
    COUNT(*) AS "hail_events_count"
FROM (
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2013"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2014"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2015"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2016"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2017"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2018"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2019"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2020"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2021"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2022"
    UNION ALL
    SELECT * FROM "NOAA_DATA_PLUS"."NOAA_HISTORIC_SEVERE_STORMS"."STORMS_2023"
) AS HAIL_EVENTS
JOIN 
    "NOAA_DATA_PLUS"."GEO_US_BOUNDARIES"."ZIP_CODES" AS z
ON ST_WITHIN(
    ST_GEOGRAPHYFROMTEXT(CONCAT('POINT(', HAIL_EVENTS."event_longitude", ' ', HAIL_EVENTS."event_latitude", ')')), 
    ST_GEOGRAPHYFROMWKB(z."zip_code_geom")
)
WHERE 
    HAIL_EVENTS."event_type" ILIKE '%hail%' -- Include only hail events
    AND HAIL_EVENTS."event_longitude" IS NOT NULL -- Exclude invalid longitude
    AND HAIL_EVENTS."event_latitude" IS NOT NULL -- Exclude invalid latitude
GROUP BY 
    z."zip_code"
ORDER BY 
    "hail_events_count" DESC NULLS LAST -- Rank top ZIP codes by total hail events across years
LIMIT 5;