2025-07-01 04:04:48 - Thread-82 (execute) - INFO - [Exploration]
```sql
--Description: Identify unique assignees (excluding DENSO CORP) among the assignees listed who may have cited patents associated with any assignee. This will provide a general understanding of potential citing assignee data.
SELECT DISTINCT f.value::VARIANT:"name"::STRING AS "assignee_name"
FROM PATENTS.PATENTS.PUBLICATIONS p, 
LATERAL FLATTEN(input => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
```

```sql
--Description: Extract distinct family IDs, which are identifiers useful in linking publications and patents, from the PUBLICATIONS table for more detailed investigations into related families.
SELECT DISTINCT "family_id"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "family_id" IS NOT NULL
LIMIT 20;
```

```sql
--Description: Retrieve unique CPC symbols (primary classifications) associated with patents. These will help identify primary CPC subclass titles.
SELECT DISTINCT f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p,
LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
```

```sql
--Description: Join the PUBLICATIONS and CPC_DEFINITION tables to retrieve the full title of CPC subclasses based on the extracted primary CPC symbols.
SELECT DISTINCT cp."symbol" AS "cpc_code", cp."titleFull" AS "cpc_title"
FROM PATENTS.PATENTS.CPC_DEFINITION cp
WHERE cp."symbol" IS NOT NULL
AND cp."titleFull" IS NOT NULL
LIMIT 20;
```

```sql
--Description: Retrieve publications citing other patents and ensure to exclude patents cited by DENSO CORP itself.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(INPUT => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
```

```sql
--Description: Extract cited publication numbers (backward references) to identify patents cited by others within the family of DENSO CORP's patents.
SELECT DISTINCT f.value::VARIANT:"publication_number"::STRING AS "cited_publication"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."citation") f
WHERE f.value::VARIANT:"publication_number"::STRING ILIKE '%%'
LIMIT 20;
```

```sql
--Description: Compile a list of DENSO CORP's patents (family IDs and publication numbers) that will later be used to find citing patents by external entities.
SELECT DISTINCT t."family_id", t."publication_number"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%DENSO CORP%'
LIMIT 20;
```

```sql
--Description: Retrieve the citing family IDs and ensure that the citing assignee is not DENSO CORP, preparing future citation links for analysis.
SELECT DISTINCT t."family_id", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
```

```sql
--Description: Retrieve the publication number and their associated CPC classifications. This table will allow linking patents to their technology classes.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
```

```sql
--Description: Group by citing assignee and their respective CPC subclass full titles with counts to evaluate the top areas where external entities are building upon DENSO CORP's technologies.
SELECT f1.value::VARIANT:"name"::STRING AS "citing_assignee", cp."titleFull" AS "cpc_title", COUNT(*) AS "citation_count"
FROM PATENTS.PATENTS.PUBLICATIONS p1
JOIN PATENTS.PATENTS.PUBLICATIONS p2 ON p1."family_id" = p2."family_id"
JOIN PATENTS.PATENTS.CPC_DEFINITION cp ON p1."cpc"::TEXT ILIKE cp."symbol"::TEXT
LATERAL FLATTEN(input => p1."assignee_harmonized") f1
WHERE f1.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
GROUP BY f1.value::VARIANT:"name"::STRING, cp."titleFull"
LIMIT 20;
```
[Exploration]
2025-07-01 04:04:48 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Identify unique assignees (excluding DENSO CORP) among the assignees listed who may have cited patents associated with any assignee. This will provide a general understanding of potential citing assignee data.
SELECT DISTINCT f.value::VARIANT:"name"::STRING AS "assignee_name"
FROM PATENTS.PATENTS.PUBLICATIONS p, 
LATERAL FLATTEN(input => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:50 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Identify unique assignees (excluding DENSO CORP) among the assignees listed who may have cited patents associated with any assignee. This will provide a general understanding of potential citing assignee data.
SELECT DISTINCT f.value::VARIANT:"name"::STRING AS "assignee_name"
FROM PATENTS.PATENTS.PUBLICATIONS p, 
LATERAL FLATTEN(input => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Results:
assignee_name
PAPER PATENTS CO
HENAN YONGRONG POWER TECH CO LTD
VOSS GREG
TYCO ELECTRONICS AMP GMBH
POLLNER REINHOLD B
MCMANUS SAMUEL P
HODGE ROBERT L
FOSHAN NATIONSTAR OPTOELECTRONICS CO LTD
CHONGQING CHUANGJIE AUTO PARTS MFG CO LTD
JIANGSU YU HENG ELECTRIC CO LTD
MILOS RASETA
FAJZULINA ELENA VALER EVNA
POTTS CHALMER A
LONGYAN HUAYAN ACTIVATED CARBON TECH CO LTD
LINHAI WEIXING NEW BUILDING MAT CO LTD
CLEMMONS DAVID L
KOTOBUKI & CO LTD
TOMAR MAHESH

[Successfully executed]
2025-07-01 04:04:50 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Extract distinct family IDs, which are identifiers useful in linking publications and patents, from the PUBLICATIONS table for more detailed investigations into related families.
SELECT DISTINCT "family_id"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "family_id" IS NOT NULL
LIMIT 20;
[Try to execute]
2025-07-01 04:04:50 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Extract distinct family IDs, which are identifiers useful in linking publications and patents, from the PUBLICATIONS table for more detailed investigations into related families.
SELECT DISTINCT "family_id"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "family_id" IS NOT NULL
LIMIT 20;
Results:
family_id
43427948
67392704
40282300
50744945
45937966
57004367
61828734
47461627
61017830
58344971
57419833
62455822
47433800
62976916
39588717
43089306
50787503
49758302
63672148
64691585

[Successfully executed]
2025-07-01 04:04:50 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Retrieve unique CPC symbols (primary classifications) associated with patents. These will help identify primary CPC subclass titles.
SELECT DISTINCT f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p,
LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:51 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Retrieve unique CPC symbols (primary classifications) associated with patents. These will help identify primary CPC subclass titles.
SELECT DISTINCT f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p,
LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
Results:
cpc_code
H01L2924/0002
G11C7/06
H01Q5/25
F28F3/086
G06T7/593
A24F47/008
G06T2207/20201
H04N5/23206
F16H2007/0893
F04D25/0606
H01J49/425
A41C5/00
F25B39/02
F28F2260/02
B32B27/08
G01M11/3127
F21V21/03
B41J2/175
B33Y80/00
A44B11/24

[Successfully executed]
2025-07-01 04:04:51 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Join the PUBLICATIONS and CPC_DEFINITION tables to retrieve the full title of CPC subclasses based on the extracted primary CPC symbols.
SELECT DISTINCT cp."symbol" AS "cpc_code", cp."titleFull" AS "cpc_title"
FROM PATENTS.PATENTS.CPC_DEFINITION cp
WHERE cp."symbol" IS NOT NULL
AND cp."titleFull" IS NOT NULL
LIMIT 20;
[Try to execute]
2025-07-01 04:04:52 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Join the PUBLICATIONS and CPC_DEFINITION tables to retrieve the full title of CPC subclasses based on the extracted primary CPC symbols.
SELECT DISTINCT cp."symbol" AS "cpc_code", cp."titleFull" AS "cpc_title"
FROM PATENTS.PATENTS.CPC_DEFINITION cp
WHERE cp."symbol" IS NOT NULL
AND cp."titleFull" IS NOT NULL
LIMIT 20;
Results:
cpc_code,cpc_title
B,PERFORMING OPERATIONS; TRANSPORTING
Y,GENERAL TAGGING OF NEW TECHNOLOGICAL DEVELOPMENTS; GENERAL TAGGING OF CROSS-SECTIONAL TECHNOLOGIES SPANNING OVER SEVERAL SECTIONS OF THE IPC; TECHNICAL SUBJECTS COVERED BY FORMER USPC CROSS-REFERENCE ART COLLECTIONS [XRACs] AND DIGESTS
E,FIXED CONSTRUCTIONS
A45,HAND OR TRAVELLING ARTICLES
A42,HEADWEAR
A23,"FOODS OR FOODSTUFFS; TREATMENT THEREOF, NOT COVERED BY OTHER CLASSES"
A62,LIFE-SAVING; FIRE-FIGHTING
A41,WEARING APPAREL

[Successfully executed]
2025-07-01 04:04:52 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Retrieve publications citing other patents and ensure to exclude patents cited by DENSO CORP itself.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(INPUT => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:53 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Retrieve publications citing other patents and ensure to exclude patents cited by DENSO CORP itself.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(INPUT => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Results:
publication_number,citing_assignee
US-2021003067-A1,TOYOTA BOSHOKU KK
US-2022195817-A1,BAKER HUGHES OILFIELD OPERATIONS LLC
US-8609418-B2,JOIL S PTE LTD
US-9297959-B2,ZOU LIJUAN
US-9087697-B2,SAMSUNG DISPLAY CO LTD
US-10911838-B2,ARRIS ENTPR INC
US-9573970-B2,LILLY CO ELI
US-2017329169-A1,SHARP KK
US-2020286856-A1,SK HYNIX INC
US-2022145047-A1,TORAY INDUSTRIES
US-8772853-B2,WANG KANG-LUNG
US-9225092-B2,SAEKI SHINICHI
US-2017353393-A1,COMCAST CABLE COMM LLC

[Successfully executed]
2025-07-01 04:04:53 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Extract cited publication numbers (backward references) to identify patents cited by others within the family of DENSO CORP's patents.
SELECT DISTINCT f.value::VARIANT:"publication_number"::STRING AS "cited_publication"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."citation") f
WHERE f.value::VARIANT:"publication_number"::STRING ILIKE '%%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:53 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Extract cited publication numbers (backward references) to identify patents cited by others within the family of DENSO CORP's patents.
SELECT DISTINCT f.value::VARIANT:"publication_number"::STRING AS "cited_publication"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."citation") f
WHERE f.value::VARIANT:"publication_number"::STRING ILIKE '%%'
LIMIT 20;
Results:
cited_publication
US-3985379-A
US-2005073278-A1
EP-0569695-A2
US-2010076435-A1
US-5451415-A
US-5777833-A
US-4513659-A
US-4235461-A
WO-2007143676-A2
US-6721445-B1
EP-1857063-A1
US-5151638-A
WO-2004058329-A2
WO-2014033433-A1
DE-856046-C
US-3985127-A
US-2002093306-A1
WO-2007042492-A1
US-2007115141-A1
US-3831516-A

[Successfully executed]
2025-07-01 04:04:53 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Compile a list of DENSO CORP's patents (family IDs and publication numbers) that will later be used to find citing patents by external entities.
SELECT DISTINCT t."family_id", t."publication_number"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%DENSO CORP%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:55 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Compile a list of DENSO CORP's patents (family IDs and publication numbers) that will later be used to find citing patents by external entities.
SELECT DISTINCT t."family_id", t."publication_number"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%DENSO CORP%'
LIMIT 20;
Results:
family_id,publication_number
38483303,JP-2007203392-A
69953091,WO-2020066482-A1
77491440,US-2022404479-A1
34631859,DE-102004061594-A1
48794740,JP-2013160905-A
83320530,US-2024010045-A1
67067256,WO-2019131297-A1
74058775,US-2021010842-A1
46839168,JP-2012158280-A
31492200,BE-1017357-A5
67619892,US-2020361416-A1
83456772,US-2024017616-A1
72333853,US-2020303905-A1
19057767,JP-2003035522-A
34464580,JP-2005101663-A
52301398,JP-2015005825-A

[Successfully executed]
2025-07-01 04:04:55 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Retrieve the citing family IDs and ensure that the citing assignee is not DENSO CORP, preparing future citation links for analysis.
SELECT DISTINCT t."family_id", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:56 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Retrieve the citing family IDs and ensure that the citing assignee is not DENSO CORP, preparing future citation links for analysis.
SELECT DISTINCT t."family_id", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Results:
family_id,citing_assignee
36683366,HAMILTON LEE
37023011,HENRY ADAM S
44655328,SUN DONG-YOON
56702191,K TRONICS SU ZHOU TECH CO LTD
66647073,YAZAKI CORP
43535070,BAECK SUK MIN
44188031,PARADNY MARK
36406118,MEDTRONIC INC
44063528,MEDTRONIC INC
44862251,DUNLAP WAYNE
44629065,ZEBRIS MEDICAL GMBH
64734308,CNH IND CANADA LTD
58545916,TAIWAN SEMICONDUCTOR MFG CO LTD
40467806,AISIN SEIKI
44655328,SAMSUNG ELECTRONICS CO LTD
45804858,GLOBALFOUNDRIES SG PTE LTD

[Successfully executed]
2025-07-01 04:04:56 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Retrieve the publication number and their associated CPC classifications. This table will allow linking patents to their technology classes.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
[Try to execute]
2025-07-01 04:04:57 - Thread-82 (execute) - INFO - [Successfully executed]
Successfully executed. SQL:
--Description: Retrieve the publication number and their associated CPC classifications. This table will allow linking patents to their technology classes.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
Results:
publication_number,cpc_code
IT-BO20010459-A0,B65D2401/20
FI-932331-A0,C07D305/14
IL-67946-A0,C07D307/52
FI-20080316-A0,A61B5/121
IL-101910-A0,H05K3/185
IL-105770-A0,C12N2730/10134
IL-116673-A0,A61K31/4439
IT-MI962322-A0,Y02T10/92
FI-972919-A0,C07D473/34
FI-831397-A0,H04L9/3226
IL-67946-A0,C07D213/61
IT-UB20153665-A1,F16L19/086
IT-MI922208-A0,G03C1/89
FI-972919-A0,A61P31/12
FI-972919-A0,C07D233/56
IL-116673-A0,A61P1/00
IT-RM20060179-A1,A61Q19/08

[Successfully executed]
2025-07-01 04:04:57 - Thread-82 (execute) - INFO - [Try to execute]
--Description: Group by citing assignee and their respective CPC subclass full titles with counts to evaluate the top areas where external entities are building upon DENSO CORP's technologies.
SELECT f1.value::VARIANT:"name"::STRING AS "citing_assignee", cp."titleFull" AS "cpc_title", COUNT(*) AS "citation_count"
FROM PATENTS.PATENTS.PUBLICATIONS p1
JOIN PATENTS.PATENTS.PUBLICATIONS p2 ON p1."family_id" = p2."family_id"
JOIN PATENTS.PATENTS.CPC_DEFINITION cp ON p1."cpc"::TEXT ILIKE cp."symbol"::TEXT
LATERAL FLATTEN(input => p1."assignee_harmonized") f1
WHERE f1.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
GROUP BY f1.value::VARIANT:"name"::STRING, cp."titleFull"
LIMIT 20;
[Try to execute]
2025-07-01 04:04:58 - Thread-82 (execute) - INFO - [Error occurred]
{'status': 'error', 'error_msg': "##ERROR##001003 (42000): SQL compilation error:\nsyntax error line 5 at position 0 unexpected 'LATERAL'."}
[Error occurred]
2025-07-01 04:05:52 - Thread-82 (execute) - INFO - [Corrected SQL]
```sql
--Description: The previous error was caused by the incorrect use of `LATERAL FLATTEN` directly in the main query, which is not allowed. 
--To resolve this, a subquery is used to preprocess the `LATERAL FLATTEN` operation, extracting the citing assignee names and their associated family IDs while excluding DENSO CORP from the results.
--This preprocessed data is then joined with the `PUBLICATIONS` table on `family_id` to link it to the corresponding CPC codes. 
--Subsequently, the `CPC_DEFINITION` table is joined to fetch the full titles for the primary CPC subclass (using the main CPC code). 
--Finally, the query is grouped by the citing assignee and CPC title to calculate the citation count for each unique combination. 
--This structured approach avoids syntax errors and ensures the correct output.

SELECT 
    citing_assignees."citing_assignee", 
    cp."titleFull" AS "cpc_title", 
    COUNT(*) AS "citation_count"
FROM (
    -- Subquery to preprocess the citing assignees and exclude DENSO CORP
    SELECT DISTINCT 
        p."family_id", 
        f.value::VARIANT:"name"::STRING AS "citing_assignee"
    FROM PATENTS.PATENTS.PUBLICATIONS p, 
    LATERAL FLATTEN(input => p."assignee_harmonized") f
    WHERE f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
) citing_assignees
JOIN PATENTS.PATENTS.PUBLICATIONS p1 
    ON citing_assignees."family_id" = p1."family_id"
JOIN PATENTS.PATENTS.CPC_DEFINITION cp 
    ON SUBSTR(p1."cpc"::TEXT, 0, 8) = cp."symbol" -- Restricting to the primary CPC code
GROUP BY citing_assignees."citing_assignee", cp."titleFull"
LIMIT 20;
```
[Corrected SQL]
2025-07-01 04:06:14 - Thread-82 (execute) - INFO - [Results for corrected sql]
No data found for the specified query.

[Results for corrected sql]
2025-07-01 04:07:10 - Thread-82 (execute) - INFO - [Corrected SQL]
```sql
--Description: To resolve the issue of no data being found, we start by simplifying the query to focus on the core data elements necessary to answer the task.
--Instead of joining multiple tables or attempting to retrieve full CPC titles, we use only the PUBLICATIONS table to extract citing assignees and their associated CPC codes.
--The conditions are kept straightforward by excluding DENSO CORP from the citing assignees and ensuring the query looks at all available CPC codes.
--We group by the citing assignee and the CPC code to count citations, avoiding any complex joins or conditions that might filter out data prematurely.
--This approach ensures that we retrieve basic citation data relevant to assessing where other assignees are building upon DENSO CORP's technologies.

SELECT 
    f1.value::VARIANT:"name"::STRING AS "citing_assignee", 
    f2.value::VARIANT:"code"::STRING AS "cpc_code", 
    COUNT(*) AS "citation_count"
FROM PATENTS.PATENTS.PUBLICATIONS p1
LATERAL FLATTEN(input => p1."assignee_harmonized") f1, 
LATERAL FLATTEN(input => p1."cpc") f2
WHERE f1.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
GROUP BY f1.value::VARIANT:"name"::STRING, f2.value::VARIANT:"code"
LIMIT 20;
```
[Corrected SQL]
2025-07-01 04:07:11 - Thread-82 (execute) - INFO - [Results for corrected sql]
{'status': 'error', 'error_msg': "##ERROR##001003 (42000): SQL compilation error:\nsyntax error line 6 at position 0 unexpected 'LATERAL'."}
[Results for corrected sql]
2025-07-01 04:08:24 - Thread-82 (execute) - INFO - [Corrected SQL]
```sql
--Description: The original query failed due to an invalid use of `LATERAL FLATTEN` inline with joins and WHERE conditions. 
--To correct this, the solution separates the data extraction into two logical subqueries: 
--1) A subquery to process and flatten citing assignees and family IDs, excluding DENSO CORP as a citing assignee.
--2) A subquery to extract and flatten CPC codes alongside their associated family IDs from the PUBLICATIONS table.
--These two subqueries are joined using family IDs as a common key, and the resulting CPC codes are matched with the CPC_DEFINITION table to retrieve the corresponding CPC titles.
--Finally, the query groups by citing assignee and CPC title, counting the number of citations for each combination, ensuring clarity and avoiding structural errors.
--This approach ensures correctness, simplicity, and scalability for data processing.

SELECT 
    assignees_data."citing_assignee", 
    cp."titleFull" AS "cpc_title", 
    COUNT(*) AS "citation_count"
FROM (
    -- Subquery to preprocess citing assignees and associate them with family IDs while excluding DENSO CORP
    SELECT DISTINCT 
        pub1."family_id", 
        assignee_info.value::VARIANT:"name"::STRING AS "citing_assignee"
    FROM PATENTS.PATENTS.PUBLICATIONS pub1, 
    LATERAL FLATTEN(input => pub1."assignee_harmonized") assignee_info
    WHERE assignee_info.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
) assignees_data
JOIN (
    -- Subquery to flatten CPC codes associated with family IDs
    SELECT 
        pub2."family_id", 
        cpc_info.value::VARIANT:"code"::STRING AS "cpc_code"
    FROM PATENTS.PATENTS.PUBLICATIONS pub2, 
    LATERAL FLATTEN(input => pub2."cpc") cpc_info
) cpc_data
    ON assignees_data."family_id" = cpc_data."family_id"
JOIN PATENTS.PATENTS.CPC_DEFINITION cp 
    ON cpc_data."cpc_code" = cp."symbol"
GROUP BY assignees_data."citing_assignee", cp."titleFull"
LIMIT 20;
```
[Corrected SQL]
2025-07-01 04:09:28 - Thread-82 (execute) - INFO - [Results for corrected sql]
citing_assignee,cpc_title,citation_count
ANHUI YINGFA RUINENG TECH CO LTD,Manufacturing or production processes characterised by the final manufactured product,1
SHIYAN ASSOCIATION OF IND AND TRADE CO LTD,Recycling,1
NISSAN MOTOR,"Construction or manufacture of accumulators having only flat construction elements, i.e. flat positive electrodes, flat negative electrodes and flat separators",10
SIGNAL PHARM LLC,Drugs for disorders of the nervous system,2
ACTV INC,"Data services, e.g. news tick

[Results for corrected sql]
2025-07-01 04:09:28 - Thread-82 (execute) - INFO - [Successfully corrected]
Successfully executed. SQL:
--Description: Group by citing assignee and their respective CPC subclass full titles with counts to evaluate the top areas where external entities are building upon DENSO CORP's technologies.
SELECT f1.value::VARIANT:"name"::STRING AS "citing_assignee", cp."titleFull" AS "cpc_title", COUNT(*) AS "citation_count"
FROM PATENTS.PATENTS.PUBLICATIONS p1
JOIN PATENTS.PATENTS.PUBLICATIONS p2 ON p1."family_id" = p2."family_id"
JOIN PATENTS.PATENTS.CPC_DEFINITION cp ON p1."cpc"::TEXT ILIKE cp."symbol"::TEXT
LATERAL FLATTEN(input => p1."assignee_harmonized") f1
WHERE f1.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
GROUP BY f1.value::VARIANT:"name"::STRING, cp."titleFull"
LIMIT 20;
Results:
citing_assignee,cpc_title,citation_count
ANHUI YINGFA RUINENG TECH CO LTD,Manufacturing or production processes characterised by the final manufactured product,1
SHIYAN ASSOCIATION OF IND AND TRADE CO LTD,Recycling,1
NISSAN MOTOR,"Construction or manufacture of accumulators having only flat construction elements, i.e. flat positive electrodes, flat negative electrodes and flat separators",10
SIGNAL PHARM LLC,Drugs for disorders of the nervous system,2
ACTV INC,"Data services, e.g. news tick

[Successfully corrected]
2025-07-01 04:09:28 - Thread-82 (execute) - INFO - itercount: 0
2025-07-01 04:09:28 - Thread-82 (execute) - INFO - [Self-refine]
Table full name: PATENTS.PATENTS.DISCLOSURES_13
Column name: patent_owner_harmonized Type: TEXT
Column name: record_id Type: TEXT
Column name: family_id Type: TEXT
Column name: pub_cleaned Type: TEXT
Sample rows:
[{'family_id': '22549751', 'record_id': 'REC00002', 'patent_owner_harmonized': '3M', 'pub_cleaned': 'US3692255'}, {'family_id': '23170520', 'record_id': 'REC00001', 'patent_owner_harmonized': '3M', 'pub_cleaned': 'US3861619'}, {'family_id': '23170520', 'record_id': 'REC00006', 'patent_owner_harmonized': '3M', 'pub_cleaned': 'US3861619'}, {'family_id': '22549751', 'record_id': 'REC00008', 'patent_owner_harmonized': '3M', 'pub_cleaned': 'US3692255'}, {'family_id': '23418274', 'record_id': 'REC00024', 'patent_owner_harmonized': 'Agilent Technologies', 'pub_cleaned': 'US5566180'}]
--------------------------------------------------
Table full name: PATENTS.PATENTS.PUBLICATIONS
Column name: grant_date Type: NUMBER Description: For US publications only, the claims in plain text
Column name: cpc Type: VARIANT Description: Two-letter language code for this text
Column name: publication_date Type: NUMBER Description: Two-letter language code for this text
Column name: ipc Type: VARIANT Description: Localized text
Column name: filing_date Type: NUMBER Description: Is this text truncated?
Column name: assignee Type: VARIANT Description: Localized text
Column name: citation Type: VARIANT Description: Two-letter language code for this text
Column name: fi Type: VARIANT Description: Is this text truncated?
Column name: priority_claim Type: VARIANT Description: Two-letter language code for this text
Column name: assignee_harmonized Type: VARIANT Description: Two-letter language code for this text
Column name: title_localized Type: VARIANT Description: The publication titles in different languages
Column name: child Type: VARIANT Description: The publication date.
Column name: family_id Type: TEXT Description: Family ID (simple family). Grouping on family ID will return all publications associated with a simple patent family (all publications share the same priority claims).
Column name: publication_number Type: TEXT Description: Patent publication number (DOCDB compatible), eg: 'US-7650331-B1'
Column name: country_code Type: TEXT Description: Country code, eg: 'US', 'EP', etc
Sample rows:
[{'publication_number': 'DE-69611147-T2', 'country_code': 'DE', 'family_id': '9483724', 'title_localized': '[\n  {\n    "language": "de",\n    "text": "Schloss vom Typ eines entkuppelbaren Rotors",\n    "truncated": false\n  }\n]', 'publication_date': 20010621, 'filing_date': 19961015, 'grant_date': 20010621, 'priority_claim': '[\n  {\n    "application_number": "FR-9512326-A",\n    "category": "",\n    "filing_date": 19951018,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  }\n]', 'assignee': '[\n  "Valeo Securite Habitacle, Creteil Cedex"\n]', 'assignee_harmonized': '[\n  {\n    "country_code": "FR",\n    "name": "VALEO SECURITE HABITACLE"\n  }\n]', 'ipc': '[\n  {\n    "code": "E05B17/04",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "E05B17/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  }\n]', 'cpc': '[\n  {\n    "code": "E05B77/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "E05B17/0058",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  }\n]', 'citation': '[]', 'child': '[]'}, {'publication_number': 'DE-69630331-T2', 'country_code': 'DE', 'family_id': '23689246', 'title_localized': '[\n  {\n    "language": "de",\n    "text": "Verfahren zur gesicherten Sitzungsschlüsselerzeugung und zur Authentifizierung",\n    "truncated": false\n  }\n]', 'publication_date': 20040729, 'filing_date': 19960416, 'grant_date': 20040729, 'priority_claim': '[\n  {\n    "application_number": "US-42609095-A",\n    "category": "",\n    "filing_date": 19950421,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  }\n]', 'assignee': '[\n  "Certicom Corp., Mississauga"\n]', 'assignee_harmonized': '[\n  {\n    "country_code": "CA",\n    "name": "CERTICOM CORP"\n  }\n]', 'ipc': '[\n  {\n    "code": "H04L9/08",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G06F7/72",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  }\n]', 'cpc': '[\n  {\n    "code": "G06F7/725",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "H04L9/0844",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "H04L9/0838",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "H04L9/0844",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G06F7/725",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  }\n]', 'citation': '[]', 'child': '[]'}, {'publication_number': 'DE-69636755-T2', 'country_code': 'DE', 'family_id': '8224764', 'title_localized': '[\n  {\n    "language": "de",\n    "text": "Immortalisierte menschliche Epithelzell-Linie",\n    "truncated": false\n  }\n]', 'publication_date': 20071011, 'filing_date': 19961224, 'grant_date': 20071011, 'priority_claim': '[\n  {\n    "application_number": "EP-96203707-A",\n    "category": "",\n    "filing_date": 19961224,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  }\n]', 'assignee': '[\n  "Société des Produits Nestlé S.A."\n]', 'assignee_harmonized': '[\n  {\n    "country_code": "CH",\n    "name": "NESTLE SA"\n  }\n]', 'ipc': '[\n  {\n    "code": "C12N5/10",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G01N33/50",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12R1/91",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "C12N15/09",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12N5/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "A61K35/44",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G01N33/48",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12Q1/68",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12N5/071",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  }\n]', 'cpc': '[\n  {\n    "code": "C12N2503/02",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "C12N5/0621",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12N2503/02",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "C12N2510/04",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "C12N5/0621",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "C12N2510/04",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  }\n]', 'citation': '[]', 'child': '[]'}, {'publication_number': 'DE-69728658-T2', 'country_code': 'DE', 'family_id': '24437397', 'title_localized': '[\n  {\n    "language": "de",\n    "text": "Lithographische dünne filmstruktur und diese enthaltende druckplatte",\n    "truncated": false\n  }\n]', 'publication_date': 20040812, 'filing_date': 19970115, 'grant_date': 20040812, 'priority_claim': '[\n  {\n    "application_number": "US-9700408-W",\n    "category": "",\n    "filing_date": 19970115,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  },\n  {\n    "application_number": "US-60864696-A",\n    "category": "",\n    "filing_date": 19960229,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  }\n]', 'assignee': '[\n  "Presstek, Inc."\n]', 'assignee_harmonized': '[\n  {\n    "country_code": "US",\n    "name": "PRESSTEK INC"\n  }\n]', 'ipc': '[\n  {\n    "code": "B32B15/04",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B41C1/10",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B41N1/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B41N1/14",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B27/20",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B7/02",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  }\n]', 'cpc': '[\n  {\n    "code": "B32B15/04",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12674",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B32B27/20",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/31678",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12458",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/31678",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12458",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B32B15/20",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/31504",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B41N1/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B15/09",\n    "first": true,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B2367/00",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B32B27/20",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12493",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B32B15/043",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B27/36",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B27/08",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "B32B15/04",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12493",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12674",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B41C1/1033",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B41N1/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12528",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/31504",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B41C1/1033",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "B32B2311/24",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  },\n  {\n    "code": "Y10T428/12528",\n    "first": false,\n    "inventive": false,\n    "tree": []\n  }\n]', 'citation': '[]', 'child': '[]'}, {'publication_number': 'DE-69807539-T2', 'country_code': 'DE', 'family_id': '11877005', 'title_localized': '[\n  {\n    "language": "de",\n    "text": "Automatisches Analysegerät",\n    "truncated": false\n  }\n]', 'publication_date': 20030116, 'filing_date': 19980120, 'grant_date': 20030116, 'priority_claim': '[\n  {\n    "application_number": "JP-1501397-A",\n    "category": "",\n    "filing_date": 19970129,\n    "npl_text": "",\n    "publication_number": "",\n    "type": ""\n  }\n]', 'assignee': '[\n  "Hitachi, Ltd."\n]', 'assignee_harmonized': '[\n  {\n    "country_code": "JP",\n    "name": "HITACHI LTD"\n  }\n]', 'ipc': '[\n  {\n    "code": "G01N35/00",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G01N35/02",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  },\n  {\n    "code": "G01N35/04",\n    "first": false,\n    "inventive": true,\n    "tree": []\n  }\n]', 'cpc': '[\n  {\n    "code": "Y10T436/115831",\n    "first": false,\n    "invent
--------------------------------------------------
Table full name: PATENTS.PATENTS.CPC_DEFINITION
Column name: limitingReferences Type: VARIANT
Column name: titleFull Type: TEXT
Column name: dateRevised Type: FLOAT
Column name: symbol Type: TEXT
Column name: parents Type: VARIANT
Sample rows:
[{'dateRevised': 20130101.0, 'limitingReferences': '[]', 'parents': '[\n  "A01K2227/10",\n  "A01K2227/00",\n  "A01K",\n  "A01",\n  "A"\n]', 'symbol': 'A01K2227/108', 'titleFull': 'Swine'}, {'dateRevised': 20130101.0, 'limitingReferences': '[]', 'parents': '[\n  "A01K2227/10",\n  "A01K2227/00",\n  "A01K",\n  "A01",\n  "A"\n]', 'symbol': 'A01K2227/105', 'titleFull': 'Murine'}, {'dateRevised': 20130101.0, 'limitingReferences': '[]', 'parents': '[\n  "A01K2227/10",\n  "A01K2227/00",\n  "A01K",\n  "A01",\n  "A"\n]', 'symbol': 'A01K2227/107', 'titleFull': 'Rabbit'}, {'dateRevised': 20130101.0, 'limitingReferences': '[]', 'parents': '[\n  "A01K2267/02",\n  "A01K2267/00",\n  "A01K",\n  "A01",\n  "A"\n]', 'symbol': 'A01K2267/025', 'titleFull': 'Animal producing cells or organs for transplantation'}, {'dateRevised': 20130101.0, 'limitingReferences': '[]', 'parents': '[\n  "A01K2267/03",\n  "A01K2267/00",\n  "A01K",\n  "A01",\n  "A"\n]', 'symbol': 'A01K2267/0306', 'titleFull': 'Animal model for genetic diseases'}]
--------------------------------------------------
External knowledge that might be helpful: 
### IPC Codes: Handling Main IPC Code Selection

When dealing with the `ipc` field in the `patents-public-data.patents.publications` dataset, it is important to understand the structure of this field, especially the subfield `first`. This subfield is a boolean that indicates whether a given IPC code is the main code for the publication number in question. This is crucial because each patent publication can be associated with multiple IPC codes, signifying the various aspects of the technology covered by the patent.

However, not every publication in the dataset has a designated main IPC code. This lack of a clearly identified main IPC code complicates the process of determining the most relevant IPC code for each publication, as selecting a single IPC code from multiple possibilities without clear prioritization can lead to inconsistent or skewed analyses.

This approach ensures a more consistent and representative selection of IPC codes across the dataset, facilitating more accurate and meaningful analysis of patent trends and classifications. By focusing on the most frequently occurring 4-digit IPC code, the view helps overcome the limitations posed by the absence of a designated main IPC code, thereby enhancing the reliability of patent-related studies and insights derived from this data.

Here is an example

```
SELECT 
    t1.publication_number, 
    SUBSTR(ipc_u.code, 0, 4) as ipc4, 
    COUNT(
    SUBSTR(ipc_u.code, 0, 4)
    ) as ipc4_count 
FROM 
    `patents-public-data.patents.publications` t1, 
    UNNEST(ipc) AS ipc_u 
GROUP BY 
    t1.publication_number, 
    ipc4

```



# Text Embeddings (Similarity)

Patent documents are rich with textual data. In fact, most of the information contained in a patent document is text. This includes the `abstract_localized`, `description_localized`, and `claims_localized`. Textual data can be a powerful tool to analyze and compare patent scope and content across patents. However, before being able to use textual data, it needs to be vectorized or transformed into text embeddings that can be used by machine learning models. Therefore, creating text embeddings from the textual data of patents is necessary to compare patent contents. Technically speaking, running an NLP algorithm that creates embeddings for all U.S. patents is computationally difficult.

Nevertheless, Google runs their own machine learning algorithm which transforms patent text metadata into text embeddings which they report in `patents-public-data.google_patents_research.publications` table. The textual embeddings of one patent, without any knowledge on the algorithm being used to create them, are meaningless on their own. However, the embeddings are powerful when it comes to comparing textual content of two or more patents. Embeddings can be used to calculate a similarity score between any two patents. This similarity score is calculated by applying the dot product of the embeddings vector of the patents, as shown below:

The similarity \( \text{Similarty}_{i,k} \) between two patents \( i \) and \( k \) is calculated as the dot product of their embedding vectors:

\[
\text{Similarty}_{i,k} = \mathbf{v}_i \cdot \mathbf{v}_k
\]

where

\[
\mathbf{v}_i = [v_{i1}, v_{i2}, v_{i3}, \ldots, v_{iN}]
\]
and
\[
\mathbf{v}_k = [v_{k1}, v_{k2}, v_{k3}, \ldots, v_{kN}]
\]

are the embedding vectors for patents \( i \) and \( k \) respectively. The higher the dot product, the more similar the patents.





# Originality (Trajtenberg)

One of the most important measures of a patent is "basicness". The aspects of basicness are tough to measure. Nevertheless, some literature finds that important aspects of these measures are embodied in the relationship between the invention and the technological predcessors and successors it is connected to through, for example, patent citations. We can thus use patent citations to construct measures that identify basicness and appropriability. Trajtenberg et al. 1997 provide a number of these measures. They distinguish between:

1. Forward-looking measures: measures that are derived from the relationship between an invention and subsequent technologies that build upon it. These measures are thus constructed from the forward citations. One example of a forward-looking basicness measure they provide is Generality, which is calculated as:

\[
\text{GENERALITY}_i = 1 - \sum_{k=1}^{N_i} \left( \frac{\text{NCITING}_{G_k}}{\text{NCITING}_i} \right)
\]


2. Backward-looking measures: measures that are derived from the relationship between a given patent and the body of knowledge that preceded it. These measure are thus constructed from the backward citations. One example of a backward-looking basicness measure they provide is Orginality, which is calculated as:

\[
\text{ORIGINALITY}_i = 1 - \sum_{k=1}^{N_i} \left( \frac{\text{NCITED}_{i,k}}{\text{NCITED}_i} \right)
\]

With **NCITING** and **NCITED** defined as the number of patents citing the focal patent and the number of patents cited by the focal patent, respectively. Index `i` corresponds to the focal patent considered, and `k` is the index of patent classes. For example, **NCITED_2,3** refers to the number of patents in patent class 3 and cited by our focal patent 2.


The table structure information is ({database name: {schema name: [table name]}}): 
{'PATENTS': {'PATENTS': ['DISCLOSURES_13', 'PUBLICATIONS', 'CPC_DEFINITION']}}

Some few-shot examples after column exploration may be helpful:
Query:
--Description: Identify unique assignees (excluding DENSO CORP) among the assignees listed who may have cited patents associated with any assignee. This will provide a general understanding of potential citing assignee data.
SELECT DISTINCT f.value::VARIANT:"name"::STRING AS "assignee_name"
FROM PATENTS.PATENTS.PUBLICATIONS p, 
LATERAL FLATTEN(input => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Answer:
assignee_name
PAPER PATENTS CO
HENAN YONGRONG POWER TECH CO LTD
VOSS GREG
TYCO ELECTRONICS AMP GMBH
POLLNER REINHOLD B
MCMANUS SAMUEL P
HODGE ROBERT L
FOSHAN NATIONSTAR OPTOELECTRONICS CO LTD
CHONGQING CHUANGJIE AUTO PARTS MFG CO LTD
JIANGSU YU HENG ELECTRIC CO LTD
MILOS RASETA
FAJZULINA ELENA VALER EVNA
POTTS CHALMER A
LONGYAN HUAYAN ACTIVATED CARBON TECH CO LTD
LINHAI WEIXING NEW BUILDING MAT CO LTD
CLEMMONS DAVID L
KOTOBUKI & CO LTD
TOMAR MAHESH
Query:
--Description: Extract distinct family IDs, which are identifiers useful in linking publications and patents, from the PUBLICATIONS table for more detailed investigations into related families.
SELECT DISTINCT "family_id"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "family_id" IS NOT NULL
LIMIT 20;
Answer:
family_id
43427948
67392704
40282300
50744945
45937966
57004367
61828734
47461627
61017830
58344971
57419833
62455822
47433800
62976916
39588717
43089306
50787503
49758302
63672148
64691585
Query:
--Description: Retrieve unique CPC symbols (primary classifications) associated with patents. These will help identify primary CPC subclass titles.
SELECT DISTINCT f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p,
LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
Answer:
cpc_code
H01L2924/0002
G11C7/06
H01Q5/25
F28F3/086
G06T7/593
A24F47/008
G06T2207/20201
H04N5/23206
F16H2007/0893
F04D25/0606
H01J49/425
A41C5/00
F25B39/02
F28F2260/02
B32B27/08
G01M11/3127
F21V21/03
B41J2/175
B33Y80/00
A44B11/24
Query:
--Description: Join the PUBLICATIONS and CPC_DEFINITION tables to retrieve the full title of CPC subclasses based on the extracted primary CPC symbols.
SELECT DISTINCT cp."symbol" AS "cpc_code", cp."titleFull" AS "cpc_title"
FROM PATENTS.PATENTS.CPC_DEFINITION cp
WHERE cp."symbol" IS NOT NULL
AND cp."titleFull" IS NOT NULL
LIMIT 20;
Answer:
cpc_code,cpc_title
B,PERFORMING OPERATIONS; TRANSPORTING
Y,GENERAL TAGGING OF NEW TECHNOLOGICAL DEVELOPMENTS; GENERAL TAGGING OF CROSS-SECTIONAL TECHNOLOGIES SPANNING OVER SEVERAL SECTIONS OF THE IPC; TECHNICAL SUBJECTS COVERED BY FORMER USPC CROSS-REFERENCE ART COLLECTIONS [XRACs] AND DIGESTS
E,FIXED CONSTRUCTIONS
A45,HAND OR TRAVELLING ARTICLES
A42,HEADWEAR
A23,"FOODS OR FOODSTUFFS; TREATMENT THEREOF, NOT COVERED BY OTHER CLASSES"
A62,LIFE-SAVING; FIRE-FIGHTING
A41,WEARING APPAREL
Query:
--Description: Retrieve publications citing other patents and ensure to exclude patents cited by DENSO CORP itself.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(INPUT => p."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%%'
AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Answer:
publication_number,citing_assignee
US-2021003067-A1,TOYOTA BOSHOKU KK
US-2022195817-A1,BAKER HUGHES OILFIELD OPERATIONS LLC
US-8609418-B2,JOIL S PTE LTD
US-9297959-B2,ZOU LIJUAN
US-9087697-B2,SAMSUNG DISPLAY CO LTD
US-10911838-B2,ARRIS ENTPR INC
US-9573970-B2,LILLY CO ELI
US-2017329169-A1,SHARP KK
US-2020286856-A1,SK HYNIX INC
US-2022145047-A1,TORAY INDUSTRIES
US-8772853-B2,WANG KANG-LUNG
US-9225092-B2,SAEKI SHINICHI
US-2017353393-A1,COMCAST CABLE COMM LLC
Query:
--Description: Extract cited publication numbers (backward references) to identify patents cited by others within the family of DENSO CORP's patents.
SELECT DISTINCT f.value::VARIANT:"publication_number"::STRING AS "cited_publication"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."citation") f
WHERE f.value::VARIANT:"publication_number"::STRING ILIKE '%%'
LIMIT 20;
Answer:
cited_publication
US-3985379-A
US-2005073278-A1
EP-0569695-A2
US-2010076435-A1
US-5451415-A
US-5777833-A
US-4513659-A
US-4235461-A
WO-2007143676-A2
US-6721445-B1
EP-1857063-A1
US-5151638-A
WO-2004058329-A2
WO-2014033433-A1
DE-856046-C
US-3985127-A
US-2002093306-A1
WO-2007042492-A1
US-2007115141-A1
US-3831516-A
Query:
--Description: Compile a list of DENSO CORP's patents (family IDs and publication numbers) that will later be used to find citing patents by external entities.
SELECT DISTINCT t."family_id", t."publication_number"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING ILIKE '%DENSO CORP%'
LIMIT 20;
Answer:
family_id,publication_number
38483303,JP-2007203392-A
69953091,WO-2020066482-A1
77491440,US-2022404479-A1
34631859,DE-102004061594-A1
48794740,JP-2013160905-A
83320530,US-2024010045-A1
67067256,WO-2019131297-A1
74058775,US-2021010842-A1
46839168,JP-2012158280-A
31492200,BE-1017357-A5
67619892,US-2020361416-A1
83456772,US-2024017616-A1
72333853,US-2020303905-A1
19057767,JP-2003035522-A
34464580,JP-2005101663-A
52301398,JP-2015005825-A
Query:
--Description: Retrieve the citing family IDs and ensure that the citing assignee is not DENSO CORP, preparing future citation links for analysis.
SELECT DISTINCT t."family_id", f.value::VARIANT:"name"::STRING AS "citing_assignee"
FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."assignee_harmonized") f
WHERE f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
LIMIT 20;
Answer:
family_id,citing_assignee
36683366,HAMILTON LEE
37023011,HENRY ADAM S
44655328,SUN DONG-YOON
56702191,K TRONICS SU ZHOU TECH CO LTD
66647073,YAZAKI CORP
43535070,BAECK SUK MIN
44188031,PARADNY MARK
36406118,MEDTRONIC INC
44063528,MEDTRONIC INC
44862251,DUNLAP WAYNE
44629065,ZEBRIS MEDICAL GMBH
64734308,CNH IND CANADA LTD
58545916,TAIWAN SEMICONDUCTOR MFG CO LTD
40467806,AISIN SEIKI
44655328,SAMSUNG ELECTRONICS CO LTD
45804858,GLOBALFOUNDRIES SG PTE LTD
Query:
--Description: Retrieve the publication number and their associated CPC classifications. This table will allow linking patents to their technology classes.
SELECT DISTINCT p."publication_number", f.value::VARIANT:"code"::STRING AS "cpc_code"
FROM PATENTS.PATENTS.PUBLICATIONS p, LATERAL FLATTEN(input => p."cpc") f
WHERE f.value::VARIANT:"code"::STRING ILIKE '%%'
LIMIT 20;
Answer:
publication_number,cpc_code
IT-BO20010459-A0,B65D2401/20
FI-932331-A0,C07D305/14
IL-67946-A0,C07D307/52
FI-20080316-A0,A61B5/121
IL-101910-A0,H05K3/185
IL-105770-A0,C12N2730/10134
IL-116673-A0,A61K31/4439
IT-MI962322-A0,Y02T10/92
FI-972919-A0,C07D473/34
FI-831397-A0,H04L9/3226
IL-67946-A0,C07D213/61
IT-UB20153665-A1,F16L19/086
IT-MI922208-A0,G03C1/89
FI-972919-A0,A61P31/12
FI-972919-A0,C07D233/56
IL-116673-A0,A61P1/00
IT-RM20060179-A1,A61Q19/08
Task: Which assignees, excluding DENSO CORP itself, have cited patents assigned to DENSO CORP, and what are the titles of the primary CPC subclasses associated with these citations? Provide the name of each citing assignee (excluding DENSO CORP), the full title of the primary CPC subclass (based on the first CPC code), and the count of citations grouped by the citing assignee and the CPC subclass title. Ensure that only citations of patents with valid filing dates are considered, and focus on the first CPC code for each citing patent. The results should specifically exclude DENSO CORP as a citing assignee.
Another way to say it: Which assignees, excluding DENSO CORP itself, have cited patents assigned to DENSO CORP, and what are the titles of the primary CPC subclasses associated with these citations? Provide the name of each citing assignee, the full title of the CPC subclass, and the count of citations grouped by the assignee and the CPC subclass title. Please focus specifically on the main categories of the CPC codes,

Please think step by step and answer only one complete SQL in snowflake dialect in ```sql``` format.
SQL usage example: ```sql
SELECT "COLUMN_NAME" FROM DATABASE.SCHEMA.TABLE WHERE ... ``` (Adjust "DATABASE", "SCHEMA", and "TABLE" to match actual names, ensure all column names are enclosed in double quotations)
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: The table structure information is ({database name: {schema name: [table name]}}): 
{'PATENTS': {'PATENTS': ['DISCLOSURES_13', 'PUBLICATIONS', 'CPC_DEFINITION']}}

When using ORDER BY xxx DESC, add NULLS LAST to exclude null records: ORDER BY xxx DESC NULLS LAST.
When asked something without stating name or id, return both of them. e.g. Which products ...? The answer should include product_name and product_id.
When asked percentage decrease, you should return a positive value. e.g. How many percentage points in 2021 decrease compared to ...? The answer should be a positive value indicating the decresed number. Try to use ABS().
If asked two tables, you should reply with the last one instead of combining two tables. e.g. Identifying the top five states ... examine the state that ranks fourth overall and identify its top five counties. You should only answer top five counties.
Use ST_DISTANCE to calculate distance between two geographic points for more accurate answer.
If the task description does not specify the number of decimal places, retain all decimals to four places.

[Self-refine]
2025-07-01 04:09:49 - Thread-82 (execute) - INFO - [Try to run SQL in self-refine]
```sql
WITH DENSO_PATENTS AS (
    -- Retrieve family IDs and publications for patents assigned to DENSO CORP
    SELECT DISTINCT t."family_id", t."publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS t, 
    LATERAL FLATTEN(input => t."assignee_harmonized") f
    WHERE f.value::VARIANT:"name"::STRING ILIKE '%DENSO CORP%'
),
CITING_PUBLICATIONS AS (
    -- Retrieve publications citing DENSO CORP patents and exclude citations by DENSO CORP itself
    SELECT DISTINCT p."publication_number" AS "citing_publication",
           f.value::VARIANT:"name"::STRING AS "citing_assignee",
           p."family_id" AS "citing_family_id"
    FROM PATENTS.PATENTS.PUBLICATIONS p, 
    LATERAL FLATTEN(input => p."assignee_harmonized") f,
    LATERAL FLATTEN(input => p."citation") c
    WHERE c.value::VARIANT:"publication_number"::STRING IN (
        SELECT DISTINCT "publication_number" 
        FROM DENSO_PATENTS
    )
    AND f.value::VARIANT:"name"::STRING NOT ILIKE '%DENSO CORP%'
),
CITING_CPC AS (
    -- Link citing publications to their first CPC code
    SELECT DISTINCT p."publication_number" AS "citing_publication",
           SUBSTR(f.value::VARIANT:"code"::STRING, 0, 4) AS "cpc_code"
    FROM PATENTS.PATENTS.PUBLICATIONS p, 
    LATERAL FLATTEN(input => p."cpc") f
    WHERE f.value::VARIANT:"code"::STRING IS NOT NULL
),
CPC_TITLES AS (
    -- Retrieve full titles of CPC codes
    SELECT DISTINCT cp."symbol" AS "cpc_code", cp."titleFull" AS "cpc_title"
    FROM PATENTS.PATENTS.CPC_DEFINITION cp
),
CITED_INFO AS (
    -- Combine citing assignees, CPC subclass titles, and link titles to CPC codes
    SELECT cp."citing_assignee", 
           cpc."cpc_code", 
           title."cpc_title"
    FROM CITING_PUBLICATIONS cp
    JOIN CITING_CPC cpc ON cp."citing_publication" = cpc."citing_publication"
    JOIN CPC_TITLES title ON cpc."cpc_code" = title."cpc_code"
)
-- Final aggregation to count citations grouped by citing assignee and CPC subclass title
SELECT "citing_assignee", 
       "cpc_title", 
       COUNT(*) AS "citation_count"
FROM CITED_INFO
GROUP BY "citing_assignee", "cpc_title"
ORDER BY "citation_count" DESC NULLS LAST;
```
[Try to run SQL in self-refine]
2025-07-01 04:11:31 - Thread-82 (execute) - INFO - Total iteration counts: 0
